<html>
<body>
<div id='map' style='width: 100%; height: 100%;'></div>
<link href='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css' rel='stylesheet' />
<script src='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.js'></script>
<script src='./mapbox-webflow.js'></script>

<script>
  coordinates = []
  globalMap = initMap(undefined, (visibleMarkers) => {
    console.log(visibleMarkers);
    var itemsDivs = document.querySelectorAll('.map-card-property-item');
    itemsDivs.forEach((itemDiv) => {
  	  var divSlug = itemDiv.querySelector('.w-script input.jetboost-list-item').value;
  	  if(visibleMarkers.includes(divSlug)) {
  	    itemDiv.style.display = 'block';
  	  } else {
  	    itemDiv.style.display = 'none';
      }
    });
  });
  var newCoords = [
    {lat: 34.13379, long: 31.160781, slug: 1, price: '2,324,423', imageUrl: 'https://picsum.photos/id/11/10/6', address: 'הגדוד העברי 57', objectUrl: 'https://getplace-new.webflow.io/properties/967269894254' },
    {lat: 34.282088, long: 32.257386, slug: 2, price: '3324423', imageUrl: 'https://picsum.photos/id/11/10/6', address: 'הגדוד העברי 57', objectUrl: 'https://getplace-new.webflow.io/properties/967269894254'},
    {lat: 34.385049, long: 31.355724, slug: 3, price: '4324423', imageUrl: 'https://picsum.photos/id/11/10/6', address: 'הגדוד העברי 57', objectUrl: 'https://getplace-new.webflow.io/properties/967269894254'},
    {lat: 34.414208, long: 31.408244, slug: 4, price: '5324423', imageUrl: 'https://picsum.photos/id/11/10/6', address: 'הגדוד העברי 57', objectUrl: 'https://getplace-new.webflow.io/properties/967269894254'},
    {lat: 34.511402, long: 32.551693, slug: 5, price: 6324423, imageUrl: 'https://picsum.photos/id/11/10/6', address: 'הגדוד העברי 57', objectUrl: 'https://getplace-new.webflow.io/properties/967269894254'},
    {slug: 6, price: 6324423, imageUrl: 'https://picsum.photos/id/11/10/6', address: 'הגדוד העברי 57', objectUrl: 'https://getplace-new.webflow.io/properties/967269894254'},
  ];
  globalMap.changeObjectsList(newCoords);

  filterItemsByPrice = function() {
    var itemsDivs = document.querySelectorAll('.map-card-property-item');
    var newCoordinates = [];
    itemsDivs.forEach((itemDiv) => {
    	var slug = itemDiv.querySelector('.w-script input.jetboost-list-item').value;
      var priceUnparsed = itemDiv.querySelector('.w-script input.object-price').value;
      var price = parseFloat(priceUnparsed.replace(/,/g, ''));
      if(price > 3000000 && price < 6000000) {
        itemDiv.style.display = 'block';
        var objectToShow = coordinates.find((obj) => obj.slug === slug);
        if(objectToShow) {
          newCoordinates.push(objectToShow);
        }
      } else {
        itemDiv.style.display = 'none';
      }
    });
    globalMap.changeObjectsList(newCoordinates);
  }
</script>
</body>
</html>